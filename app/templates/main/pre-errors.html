{% extends "base.html" %}

{%- from 'govuk_frontend_jinja/components/file-upload/macro.html' import govukFileUpload -%}
{%- from 'govuk_frontend_jinja/components/button/macro.html' import govukButton -%}
{%- from "govuk_frontend_jinja/components/accordion/macro.html" import govukAccordion -%}
{%- from "govuk_frontend_jinja/components/accordion/macro.html" import govukNotificationBanner -%}
{%- from "govuk_frontend_jinja/components/table/macro.html" import govukTable -%}
{%- from "errorTable.html" import errorTable -%}
{%- from "errorSummary.html" import errorSummary -%}
{%- from "help-links-dropdown.html" import helpLinksDropdown -%}
{%- from "uploadTable.html" import uploadTable -%}

{% block beforeContent %}
{{ super() }}
{% endblock beforeContent %}

{% block content %}

    {{ errorSummary(pre_error) }}

    {{ uploadTable(local_authorities, fund, reporting_period) }}

    {# djlint:off #}
    <div class="upload-data-container govuk-!-margin-top-5">
        <form method="post" action="{{ url_for('main.upload') }}" enctype="multipart/form-data">
            {# construct html to display errors in bullet point list #}
            {% set ns = namespace(pre_error_html = "<div class=\"govuk-error-message\">Some of your data is not what we expect, so we could not run the full checks.
            Fix these problems and re-upload:") %}
            {% set ns.pre_error_html = ns.pre_error_html + "<ul>" %}
            {% for error in pre_error %}
                {% set ns.pre_error_html = ns.pre_error_html + "<li>" + error + "</li>" %}
            {% endfor %}
            {% set ns.pre_error_html = ns.pre_error_html + "</ul></div>" %}

            {{ govukFileUpload({'id': 'ingest_spreadsheet',
             "hint": {"text": ""},
             "label": {"text": ""},
             "errorMessage": {"html": ns.pre_error_html},
             'name': 'ingest_spreadsheet'}) }}

            <p class="govuk-body">When you upload your return, weâ€™ll check it for missing data and formatting errors.</p>

            {{ govukButton({"element": "button",
            "text": "Upload and check for errors",
            "attributes": {
                "aria-controls": "example-id",
                "data-tracking-dimension": 123} }) }}
        </form>
            {{ helpLinksDropdown() }}
    </div>

{% endblock content %}
